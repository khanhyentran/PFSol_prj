********************************************************************
Building Environment for RZ/A2M Evaluation Board
********************************************************************

1. Prepare environment to build:
	$ tar -xvf rza_linux-4.19_bsp.tar.gz
	$ cd rza_linux-4.19_bsp
	$ export WORK=$(pwd)

	$ ./build.sh config
	Enter to 
	Select "rza2mevb RZ/A2M Eval Board (RZ/A2M)", then Save.

2. Building Buildroot:
	$ ./build.sh buildroot
		1. buildroot-2017.02 (Long Term Support)
		2. buildroot-2018.02 (Long Term Support)
		=> Choose "2"
		1. Use the default Linaro toolchain (recommended)
		2. Install Buildroot and then let me decide in the configuration menu (advanced)
		=> Choose "1"

3. Building U-boot:
	$ ./build.sh u-boot

4. Building Kernel:
	$ cd $WORK/output
	$ git clone https://git.kernel.org/pub/scm/linux/kernel/git/geert/renesas-drivers.git linux-4.19
	$ cd linux-4.19
	$ git checkout master
	$ mkdir -p fs/axfs
	$ cd fs/axfs
	$ git clone https://github.com/jaredeh/axfs.git .
	$ cd $WORK/output/linux-4.19
	$ mkdir -p z_patches

	Copy "renesas-drivers-2018-10-09-v4.19-rc7_2018_10_10.txz" to "z_patches" directory and untar.

	$ git checkout -b rza2m_2018_10_10
	$ git am z_patches/renesas-drivers-2018-10-09-v4.19-rc7_2018_10_10/00*.patch
	$ git am z_patches/renesas-drivers-2018-10-09-v4.19-rc7_2018_10_10/untracked.patch
	$ cd $WORK

	$ ./build.sh kernel rza2mevb_xip_defconfig
	$ ./build.sh kernel xipImage

5. Deloy to RZA2MEVB Board:
	Binary files is located at:
		U-boot: 		$WORK/output/u-boot-2017.05/u-boot.bin
		Device tree:	$WORK/output/linux-4.19/arch/arm/boot/dts/r7s9210-rza2mevb.dtb
		Kernel:			$WORK/output/linux-4.19/arch/arm/boot/xipImage
		File system:	$WORK/output/buildroot-2018.02/output/images/rootfs.axfs
You should download the JLINK at https://www.segger.com/downloads/jlink/ to Host PC, 
such as JLink_Linux_V631j_x86_64.deb
	Program to QSPI:
		./build.sh jlink u-boot
		./build.sh jlink rootfs_axfs 0x20800000
		./build.sh jlink dtb
		./build.sh jlink xipImage 0x20200000

6. Booting
Connect board to Host PC, open Terminal, 
	=> run xha_boot


===
U-Boot 2017.05-g4bc77df (Oct 17 2018 - 17:13:31 +0700)

CPU: Renesas Electronics CPU rev 0.0
Board: RZA2MEVB
I2C:   ready
DRAM:  4 MiB
SF: Detected mx25l51235f with page size 256 Bytes, erase size 64 KiB, total 64 B
*** Warning - bad CRC, using default environment

In:    serial_sh
Out:   serial_sh
Err:   serial_sh
                      SPI Flash Memory Map
                ------------------------------------
                         Start      Size
                u-boot:  0x00000000 0x080000
                   env:  0x00080000 0x010000
                    DT:  0x000C0000 0x010000
                Kernel:  0x00200000 0x050000
                rootfs:  0x00800000 0xFFC00000

                 ON     SW6
                 +---------------------+
                 |       = = = =       |
                 | = = =               |
                 | 1 2 3 4 5 6 7 8 9 0 |  Please make sure your sub-board matchs
                 +---------------------+  these switch settings.
        SW6-1 set to Other
        SW6-2 set to Audio
        SW6-3 set to USB, CAN, UART(console)
        SW6-4 set to Ether1
        SW6-5 set to Ether2
        SW6-6 set to VDC6
        SW6-7 set to VDC6

Net:   sh_eth
=> run xha_boot

Current Mode: Fast Read Mode (3-byte Addr)
SF: Detected mx25l51235f with page size 256 Bytes, erase size 64 KiB, total 64 B
New Mode: Quad I/O Read Mode (4-byte Addr)
Booting Linux...
[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 4.19.0-rc7-00021-ge7b4840 (rvc@3F-L8705-LB00) (gcc8
[    0.000000] CPU: ARMv7 Processor [414fc091] revision 1 (ARMv7), cr=50c53c7d
[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instructie
[    0.000000] OF: fdt: Machine model: RZA2MEVB
[    0.000000] debug: ignoring loglevel setting.
[    0.000000] earlycon: scif0 at MMIO 0xe8009000 (options '115200n8')
[    0.000000] bootconsole [scif0] enabled
[    0.000000] Memory policy: Data cache writeback
[    0.000000] On node 0 totalpages: 2048
[    0.000000]   Normal zone: 16 pages used for memmap
[    0.000000]   Normal zone: 0 pages reserved
[    0.000000]   Normal zone: 2048 pages, LIFO batch:0
[    0.000000] CPU: All CPU(s) started in SVC mode.
[    0.000000] random: get_random_bytes called from start_kernel+0x53/0x2c8 wit0
[    0.000000] pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768
[    0.000000] pcpu-alloc: [0] 0 
[    0.000000] Built 1 zonelists, mobility grouping off.  Total pages: 2032
[    0.000000] Kernel command line: ignore_loglevel earlycon rootfstype=axfs ro 
[    0.000000] Dentry cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.000000] Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.000000] Memory: 7524K/8192K available (2752K kernel code, 184K rwdata, 8)
[    0.000000] Virtual kernel memory layout:
[    0.000000]     vector  : 0xffff0000 - 0xffff1000   (   4 kB)
[    0.000000]     fixmap  : 0xffc00000 - 0xfff00000   (3072 kB)
[    0.000000]     vmalloc : 0xc1000000 - 0xff800000   (1000 MB)
[    0.000000]     lowmem  : 0xc0000000 - 0xc0800000   (   8 MB)
[    0.000000]       .text : 0x(ptrval) - 0x(ptrval)   (3597 kB)
[    0.000000]       .init : 0x(ptrval) - 0x(ptrval)   (  48 kB)
[    0.000000]       .data : 0x(ptrval) - 0x(ptrval)   ( 185 kB)
[    0.000000]        .bss : 0x(ptrval) - 0x(ptrval)   ( 251 kB)
[    0.000000] NR_IRQS: 16, nr_irqs: 16, preallocated irqs: 16
[    0.000000] L2C-310 cache controller enabled, 8 ways, 128 kB
[    0.000000] L2C-310: CACHE_ID 0x410000c9, AUX_CTRL 0x02020000
[    0.000000] clocksource: ostm: mask: 0xffffffff max_cycles: 0xffffffff, max_s
[    0.000083] sched_clock: 32 bits at 66MHz, resolution 15ns, wraps every 3253s
[    0.007978] ostm: used for clocksource
[    0.013063] ostm: used for clock events
[    0.018991] Console: colour dummy device 80x30
[    0.024957] console [tty0] enabled
[    0.028580] bootconsole [scif0] disabled
[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 4.19.0-rc7-00021-ge7b4840 (rvc@3F-L8705-LB00) (gcc8
[    0.000000] CPU: ARMv7 Processor [414fc091] revision 1 (ARMv7), cr=50c53c7d
[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instructie
[    0.000000] OF: fdt: Machine model: RZA2MEVB
[    0.000000] debug: ignoring loglevel setting.
[    0.000000] earlycon: scif0 at MMIO 0xe8009000 (options '115200n8')
[    0.000000] bootconsole [scif0] enabled
[    0.000000] Memory policy: Data cache writeback
[    0.000000] On node 0 totalpages: 2048
[    0.000000]   Normal zone: 16 pages used for memmap
[    0.000000]   Normal zone: 0 pages reserved
[    0.000000]   Normal zone: 2048 pages, LIFO batch:0
[    0.000000] CPU: All CPU(s) started in SVC mode.
[    0.000000] random: get_random_bytes called from start_kernel+0x53/0x2c8 wit0
[    0.000000] pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768
[    0.000000] pcpu-alloc: [0] 0 
[    0.000000] Built 1 zonelists, mobility grouping off.  Total pages: 2032
[    0.000000] Kernel command line: ignore_loglevel earlycon rootfstype=axfs ro 
[    0.000000] Dentry cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.000000] Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.000000] Memory: 7524K/8192K available (2752K kernel code, 184K rwdata, 8)
[    0.000000] Virtual kernel memory layout:
[    0.000000]     vector  : 0xffff0000 - 0xffff1000   (   4 kB)
[    0.000000]     fixmap  : 0xffc00000 - 0xfff00000   (3072 kB)
[    0.000000]     vmalloc : 0xc1000000 - 0xff800000   (1000 MB)
[    0.000000]     lowmem  : 0xc0000000 - 0xc0800000   (   8 MB)
[    0.000000]       .text : 0x(ptrval) - 0x(ptrval)   (3597 kB)
[    0.000000]       .init : 0x(ptrval) - 0x(ptrval)   (  48 kB)
[    0.000000]       .data : 0x(ptrval) - 0x(ptrval)   ( 185 kB)
[    0.000000]        .bss : 0x(ptrval) - 0x(ptrval)   ( 251 kB)
[    0.000000] NR_IRQS: 16, nr_irqs: 16, preallocated irqs: 16
[    0.000000] L2C-310 cache controller enabled, 8 ways, 128 kB
[    0.000000] L2C-310: CACHE_ID 0x410000c9, AUX_CTRL 0x02020000
[    0.000000] clocksource: ostm: mask: 0xffffffff max_cycles: 0xffffffff, max_s
[    0.000083] sched_clock: 32 bits at 66MHz, resolution 15ns, wraps every 3253s
[    0.007978] ostm: used for clocksource
[    0.013063] ostm: used for clock events
[    0.018991] Console: colour dummy device 80x30
[    0.024957] console [tty0] enabled
[    0.028580] bootconsole [scif0] disabled
[    0.033010] Calibrating delay loop (skipped) preset value.. 1056.00 BogoMIPS)
[    0.033303] pid_max: default: 32768 minimum: 301
[    0.034559] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.034680] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.039980] CPU: Testing write buffer coherency: ok
[    0.041076] CPU0: Spectre v2: using BPIALL workaround
[    0.050752] Setting up static identity map for 0x3f8001c0 - 0x3f800214
[    0.055145] Detected Renesas RZ/A2 r7s9210 
[    0.062979] devtmpfs: initialized
[    0.075243] VFP support v0.3: implementor 41 architecture 3 part 30 variant 4
[    0.078504] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, ms
[    0.079023] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.080349] pinctrl core: initialized pinctrl subsystem
[    0.091070] NET: Registered protocol family 16
[    0.099236] DMA: preallocated 256 KiB pool for atomic coherent allocations
[    0.106361] No ATAGs?
[    0.159014] RZ/A2 pin controller registered
[    0.306507] SCSI subsystem initialized
[    0.308536] usbcore: registered new interface driver usbfs
[    0.309073] usbcore: registered new interface driver hub
[    0.309895] usbcore: registered new device driver usb
[    0.351789] clocksource: Switched to clocksource ostm
[    0.676506] NET: Registered protocol family 2
[    0.684197] tcp_listen_portaddr_hash hash table entries: 512 (order: 0, 4096)
[    0.684719] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.684829] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.684968] TCP: Hash tables configured (established 1024 bind 1024)
[    0.687060] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.687250] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.689048] NET: Registered protocol family 1
[    0.732590] workingset: timestamp_bits=30 max_order=11 bucket_order=0
[    0.737687] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.738306] jffs2: version 2.2. (NAND) �𴩩 2001-2006 Red Hat, Inc.
[    0.756329] Key type asymmetric registered
[    0.756817] Asymmetric key parser 'x509' registered
[    0.758610] Block layer SCSI generic (bsg) driver version 0.4 loaded (major )
[    0.758810] io scheduler noop registered
[    0.758852] io scheduler deadline registered
[    0.759632] io scheduler cfq registered (default)
[    0.759735] io scheduler mq-deadline registered
[    0.785214] vdc5fb fcff7400.display: fcff7400.display: [gwp0700cnwv04] dotcl2
[    0.802455] vdc5fb: Layer 2 Enabled (800x480 @ 0x80000000)
[    0.902975] vdc5fb fcff7400.display: update_regs timeout reg=00000080, bits=1
[    1.003306] vdc5fb fcff7400.display: update_regs timeout reg=00000100, bits=1
[    1.103613] vdc5fb fcff7400.display: update_regs timeout reg=00000180, bits=1
[    1.247722] Console: switching to colour frame buffer device 100x30
[    1.299890] graphics fb0: registered fcff7400.display as 800x480 @ 59 Hz, 16.
[    1.321140] SuperH (H)SCI(F) driver initialized
[    1.335141] e8009000.serial: ttySC0 at MMIO 0xe8009000 (irq = 20, base_baud f
[    1.885760] console [ttySC0] enabled
[    1.910370] 1 fixed-partitions partitions found on MTD device 20000000.qspi
[    1.924050] Creating 1 MTD partitions on "20000000.qspi":
[    1.934226] 0x000000800000-0x000001800000 : "rootfs_xipcramfs"
[    1.992948] renesas_spi e800c800.spi: dma_request_slave_channel_compat failed
[    2.006352] renesas_spi e800c800.spi: DMA not available, using PIO
[    2.049811] at25 spi0.0: 256 Byte at25 eeprom, pagesize 16
[    2.063349] renesas_spi e800c800.spi: probed
[    2.076093] libphy: Fixed MDIO Bus: probed
[    2.098281] libphy: sh_mii: probed
[    2.117887] sh-eth e8204000.ethernet eth0: Base address at 0xe8204000, 74:90.
[    2.139847] sh-eth e8204200.ethernet: no valid MAC address supplied, using a.
[    2.157030] libphy: sh_mii: probed
[    2.175269] sh-eth e8204200.ethernet eth1: Base address at 0xe8204200, 92:c0.
[    2.193648] usbcore: registered new interface driver usb-storage
[    2.207669] i2c /dev entries driver
[    2.280796] ft5x06-ts 3-0038: ft5x06_init_panel: could not detect ft5x06
[    2.295010] ft5x06-ts 3-0038: could not init touch panel
[    2.306420] ft5x06-ts: probe of 3-0038 failed with error -5
[    2.337440] at24 3-0050: 16384 byte 24c128 EEPROM, writable, 64 bytes/write
[    2.352760] i2c-riic e803ac00.i2c: registered with 400000Hz bus speed
[    2.473465] random: fast init done
[    2.509537] renesas_sdhi_internal_dmac e8228000.sd: mmc0 base at 0xe8228000 z
[    2.537126] usbcore: registered new interface driver usbhid
[    2.548845] usbhid: USB HID core driver
[    2.560795] NET: Registered protocol family 10
[    2.601027] Segment Routing with IPv6
[    2.612686] sit: IPv6, IPv4 and MPLS over IPv4 tunneling driver
[    2.634157] NET: Registered protocol family 17
[    2.644995] Key type dns_resolver registered
[    2.654796] rza2mevb_init_late: Error: Could not find QSPI clock
[    2.699729] hctosys: unable to open rtc device (rtc0)
[    2.718944] platform regulatory.0: Direct firmware load for regulatory.db fa2
[    2.733820] cfg80211: failed to load regulatory.db
[    2.758791] axfs: Proc entry created
[    2.769412] VFS: Mounted root (axfs filesystem) readonly on device 0:11.
[    2.782895] devtmpfs: mounted
[    2.791270] Freeing unused kernel memory: 48K
[    2.800201] This architecture does not have kernel memory protection.
[    2.810759] Run /sbin/init as init process
Starting logging: OK
read-only file system detected...done
Starting network: OK
Wed Oct 31 09:00:00 UTC 2018
[    6.049136] Console: switching to colour dummy device 80x30

Welcome to Buildroot
buildroot login: 
Welcome to Buildroot
buildroot login: 
Welcome to Buildroot
buildroot login: root
$ ls
bin     images  sounds
$ ls /
bin      lib      media    proc     sbin     usr
dev      lib32    mnt      root     sys      var
etc      linuxrc  opt      run      tmp
$ 


